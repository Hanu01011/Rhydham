<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Birthday Mini-Game</title>
<style>
html, body {
    margin:0;
    padding:0;
    width:100%;
    height:100%;
    display:flex;
    justify-content:center;
    align-items:center;
    background:linear-gradient(135deg,#ff758c,#ff7eb3);
    font-family:'Segoe UI',sans-serif;
    position:relative;
    overflow:hidden;
}
canvas{
    background:white;
    border-radius:15px;
    box-shadow:0 10px 25px rgba(0,0,0,0.3);
    max-width:95vw;
    max-height:80vh;
}
#scoreDisplay{
    position:absolute;
    top:5%;
    left:50%;
    transform:translateX(-50%);
    font-weight:bold;
    color:black;
    font-size:24px;
    text-align:center;
}
button{
    position:absolute;
    padding:15px 25px;
    font-size:18px;
    cursor:pointer;
    border:none;
    border-radius:10px;
    background:#ff4f81;
    color:white;
    touch-action: manipulation;
}
#playAgainBtn{
    display:none;
    top:50%;
    left:50%;
    transform:translate(-50%,-50%) scale(0);
    z-index:10;
    transition: all 0.6s ease-out;
}
#playAgainBtn.show{
    transform:translate(-50%,-50%) scale(1);
}
#closeBtn{
    top:10px;
    right:10px;
}
.confetti{
    position:absolute;
    width:8px;
    height:8px;
    background:hsl(0,100%,50%);
    top:-10px;
    animation:fall 3s linear forwards;
}
@keyframes fall{
    0%{transform:translateY(0px) rotate(0deg);}
    100%{transform:translateY(500px) rotate(360deg);opacity:0;}
}
</style>
</head>
<body>

<canvas id="game" width="400" height="400"></canvas>
<div id="scoreDisplay">Score: 0 | Level: 1</div>
<button id="playAgainBtn">Play Again üéÆ</button>
<button id="closeBtn">Close ‚ùå</button>

<script>
// ----------------- Game Setup -----------------
const canvas=document.getElementById("game");
const ctx=canvas.getContext("2d");
const scoreDisplay=document.getElementById("scoreDisplay");

let basket={x:160,y:360,w:80,h:20};
let fallingImgs=[];
let score=0;
let timeLeft=120;
let gameRunning=true;
let level=1;
let spawnRate=1200;
let fallSpeed=1.5;

// Load falling image
let aasthaImg = new Image();
aasthaImg.src = "https://i.ibb.co/7Npr7TZc/aastha.png";

// Helper function: scale image based on screen width
function getScaledSize(baseSize){
    const scale = Math.min(window.innerWidth / 400, 1); // scale down for smaller screens
    return baseSize * scale;
}

// ----------------- Functions -----------------
function spawnImgs(){
    if(!gameRunning) return;
    let count=Math.min(level,3);
    for(let i=0;i<count;i++){
        const size = getScaledSize(20+Math.random()*20); // scale size
        fallingImgs.push({
            x:Math.random()*(canvas.width-size),
            y:0,
            size:size,
            speed:fallSpeed+Math.random()*level,
            angle:Math.random()*Math.PI*2
        });
    }
    setTimeout(spawnImgs,spawnRate);
}

function gameLoop(){
    if(!gameRunning) return;
    ctx.clearRect(0,0,canvas.width,canvas.height);

    // Draw rectangle basket
    ctx.fillStyle="#ff4f81";
    ctx.fillRect(basket.x,basket.y,basket.w,basket.h);

    for(let i=fallingImgs.length-1;i>=0;i--){
        let obj = fallingImgs[i];
        obj.y += obj.speed + Math.sin(obj.y/10)*0.3;
        obj.angle += 0.03;
        let xOff = Math.sin(obj.y/20)*10;

        ctx.save();
        ctx.translate(obj.x + xOff,obj.y);
        ctx.rotate(obj.angle);
        ctx.drawImage(aasthaImg,-obj.size,-obj.size,obj.size*2,obj.size*2);
        ctx.restore();

        // Basket collision
        if(obj.y+obj.size>basket.y &&
           obj.x + xOff > basket.x &&
           obj.x + xOff < basket.x + basket.w){
            score++;
            fallingImgs.splice(i,1);
            if(score%50===0) level++;
        }

        // Game Over
        if(obj.y+obj.size>=canvas.height){
            endGame();
        }
    }

    // Update score display in middle
    scoreDisplay.innerText = `Score: ${score} | Level: ${level} | Time: ${timeLeft}s`;

    requestAnimationFrame(gameLoop);
}

// Countdown timer
function countdown(){
    let timer=setInterval(()=>{
        if(!gameRunning){clearInterval(timer);return;}
        timeLeft--;
        if(timeLeft<=0){clearInterval(timer); endGame();}
    },1000);
}

function startGame(){
    fallingImgs=[];
    score=0;
    timeLeft=120;
    level=1;
    gameRunning=true;
    document.getElementById("playAgainBtn").classList.remove("show");
    spawnImgs();
    gameLoop();
    countdown();
}

function endGame(){
    gameRunning=false;
    document.getElementById("playAgainBtn").classList.add("show");
    scoreDisplay.innerText = `Game Over! Your final score: ${score}`;
    launchConfetti();
}

// ----------------- Basket movement -----------------
// Mouse for desktop
document.addEventListener("mousemove",e=>{
    const rect=canvas.getBoundingClientRect();
    basket.x=(e.clientX-rect.left) * (canvas.width/rect.width) - basket.w/2;
});
// Touch for mobile
document.addEventListener("touchmove",e=>{
    const rect=canvas.getBoundingClientRect();
    if(e.touches.length > 0){
        basket.x=(e.touches[0].clientX-rect.left)*(canvas.width/rect.width)-basket.w/2;
    }
});

// ----------------- Buttons -----------------
document.getElementById("playAgainBtn").addEventListener("click",()=>{
    startGame();
});

document.getElementById("closeBtn").addEventListener("click",()=>{
    canvas.style.display="none";
    scoreDisplay.style.display="none";
    document.getElementById("playAgainBtn").style.display="none";
    document.getElementById("closeBtn").style.display="none";
});

// ----------------- Confetti -----------------
function launchConfetti(){
    for(let i=0;i<200;i++){
        const conf=document.createElement('div');
        conf.classList.add('confetti');
        conf.style.background = `hsl(${Math.random()*360},100%,50%)`;
        conf.style.left = Math.random()*100 + 'vw';
        conf.style.width = Math.random()*10+5+'px';
        conf.style.height = conf.style.width;
        document.body.appendChild(conf);
        setTimeout(()=>conf.remove(),3000);
    }
}

// Adjust canvas on window resize
window.addEventListener("resize",()=>{
    basket.x = Math.min(basket.x, canvas.width - basket.w);
});

startGame();
</script>
</body>
</html>
